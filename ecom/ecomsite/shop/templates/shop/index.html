<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luxury Collection | Premium Ecommerce</title>

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" 
    crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" 
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" 
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
      crossorigin="anonymous"
    ></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-4.0.0.js" integrity="sha256-9fsHeVnKBvqh3FB2HYu7g2xseAZ5MlN6Kz/qnkASV8U=" 
    crossorigin="anonymous"></script>

    <!-- Load static files -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'shop/style.css' %}" />
    
    <style>
      :root {
        --luxury-dark: #0a0a0a;
        --luxury-gold: #d4a574;
        --luxury-light: #f5f3f0;
        --luxury-white: #ffffff;
      }

      body {
        background: linear-gradient(135deg, #f5f3f0 0%, #e8e4df 100%);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
      }

      /* Premium Header */
      .premium-header {
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
        padding: 20px 0;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 40px;
      }

      .premium-header .brand {
        font-size: 28px;
        font-weight: 700;
        color: var(--luxury-gold);
        letter-spacing: 2px;
      }

      /* Premium Search Bar */
      .premium-search-form {
        background: var(--luxury-white);
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        padding: 15px 20px;
        border: 2px solid var(--luxury-gold);
        margin-bottom: 40px;
      }

      .premium-search-form .form-control {
        border: none;
        font-size: 16px;
        padding: 12px 0;
        background: transparent;
      }

      .premium-search-form .form-control::placeholder {
        color: #bbb;
      }

      .premium-search-form .form-control:focus {
        box-shadow: none;
        border-bottom: 2px solid var(--luxury-gold);
        outline: none;
      }

      .premium-search-form .btn-search {
        background: linear-gradient(135deg, #d4a574 0%, #b8904a 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 10px 30px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .premium-search-form .btn-search:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(212, 165, 116, 0.4);
      }

      /* Premium Product Cards */
      .premium-product-card {
        background: var(--luxury-white);
        border: none;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .premium-product-card:hover {
        transform: translateY(-12px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.15);
      }

      .premium-product-card .product-image {
        position: relative;
        overflow: hidden;
        height: 280px;
        background: linear-gradient(135deg, #f5f3f0 0%, #e8e4df 100%);
      }

      .premium-product-card .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .premium-product-card:hover .product-image img {
        transform: scale(1.08);
      }

      .premium-product-card .product-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: var(--luxury-gold);
        color: var(--luxury-dark);
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 700;
      }

      .premium-product-card .card-body {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      .premium-product-card .card-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--luxury-dark);
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .premium-product-card .category-badge {
        display: inline-block;
        background: #f0f0f0;
        color: #666;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        margin-bottom: 12px;
        width: fit-content;
      }

      .premium-product-card .price-section {
        margin: 15px 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .premium-product-card .original-price {
        font-size: 14px;
        color: #999;
        text-decoration: line-through;
      }

      .premium-product-card .sale-price {
        font-size: 20px;
        font-weight: 700;
        color: var(--luxury-gold);
      }

      .premium-product-card .current-price {
        font-size: 20px;
        font-weight: 700;
        color: var(--luxury-dark);
      }

      .premium-product-card .card-actions {
        display: flex;
        gap: 10px;
        margin-top: auto;
      }

      .premium-product-card .btn-view {
        flex: 1;
        background: linear-gradient(135deg, #d4a574 0%, #b8904a 100%);
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.3s ease;
        padding: 10px 15px;
        font-size: 13px;
      }

      .premium-product-card .btn-view:hover {
        background: linear-gradient(135deg, #e6b886 0%, #c9a356 100%);
        text-decoration: none;
        color: white;
      }

      .premium-product-card .btn-cart {
        flex: 1;
        background: var(--luxury-dark);
        border: 2px solid var(--luxury-gold);
        color: var(--luxury-gold);
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.3s ease;
        padding: 10px 15px;
        font-size: 13px;
      }

      .premium-product-card .btn-cart:hover {
        background: var(--luxury-gold);
        color: var(--luxury-dark);
      }

      /* Pagination Styles */
      .premium-pagination .pagination {
        gap: 5px;
      }

      .premium-pagination .page-link {
        border: 2px solid #ddd;
        color: var(--luxury-dark);
        font-weight: 600;
        border-radius: 6px;
        margin: 0 2px;
      }

      .premium-pagination .page-link:hover,
      .premium-pagination .page-item.active .page-link {
        background: linear-gradient(135deg, #d4a574 0%, #b8904a 100%);
        border-color: var(--luxury-gold);
        color: white;
      }

      .premium-pagination .page-item.disabled .page-link {
        color: #ccc;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <!-- Premium Header -->
    <!-- <div class="premium-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="brand">
              <i class="fas fa-crown" style="color: var(--luxury-gold);"></i> LUXURY COLLECTION
            </div>
          </div>
          <div class="col-md-6 text-right">
            <span style="color: var(--luxury-gold); font-weight: 600;">âœ“ Premium | Exclusive | Authentic</span>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Navigation Bar -->
    <div class="col-md-12">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Features</a>
            </li>
            <li class="nav-item">
              <button type="button" id="cart" class="btn btn-secondary" data-container="body" data-toggle="popover" data-placement="bottom" 
                 data-html="true">
                Cart
              </button>
            </li>
            <!-- <li class="nav-item">
              <a class="nav-link disabled" href="#">Disabled</a>
            </li> -->
          </ul>
        </div>
      </nav>
    </div>

    <br>

    <div class="container">
      <!-- Premium Search Bar -->
      <form class="premium-search-form" method="GET">
        <div class="row">
          <div class="col-md-10">
            <input type="search" name="item_name" placeholder="Search our exclusive collection..." class="form-control">
          </div>
          <div class="col-md-2 text-right">
            <button class="btn btn-search" type="submit">
              <i class="fas fa-search"></i> Search
            </button>
          </div>
        </div>
      </form>

      <!-- Product Listing -->
      <div class="row" style="margin-bottom: 50px;">
        {% for product in product_objects %}
        <div class="col-lg-3 col-md-6 mb-4">
          <div class="premium-product-card">
            <div class="product-image">
              <img src="{{product.image}}" alt="Image of {{product.name}}" />
              {% if product.discount_price %}
              <div class="product-badge">ON SALE</div>
              {% endif %}
            </div>

            <div class="card-body">
              <h5 class="card-title" id="nm-{{product.id}}">{{product.name}}</h5>
              
              <div class="category-badge">
                <i class="fas fa-tag"></i> {{product.category}}
              </div>

              <div class="price-section">
                {% if product.discount_price %}
                  <span class="original-price">R {{product.price}}</span>
                  <span class="sale-price">R {{product.discount_price}}</span>
                {% else %}
                  <span class="current-price">R {{product.price}}</span>
                {% endif %}
              </div>

              
              <div class="card-actions">
                <!-- View Button -->
                <a href="/{{product.id}}/" class="btn btn-view">
                  <i class="fas fa-eye"></i> View
                </a>
<<<<<<< HEAD
                <button class="btn btn-cart atc" id="{{product.id}}">
=======
                <!-- Add to Cart Button -->
                <button id="{{product.id}}" class="btn btn-cart atc">
>>>>>>> d7390dd164519c535f2523a38e744b23f49144c9
                  <i class="fas fa-shopping-bag"></i>
                </button>
              </div>
            </div>
            </div>
            </div>
        {% endfor %}
      </div>
      <!-- Pagination -->
      <div class="row premium-pagination" style="margin-top: 50px; margin-bottom: 50px;">
        <div class="col-md-12">
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
              <div class="row">
                <div class="col-md-12">
                  <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">

                      <!-- Previous Page Link -->
                      {% if product_objects.has_previous %}
                      <li class="page-item">
                        <a class="page-link" href="?page={{ product_objects.previous_page_number }}{% if request.GET.item_name %}&item_name={{ request.GET.item_name }}{% endif %}" aria-label="Previous">
                          <span aria-hidden="true">&laquo;</span>
                        </a>
                      </li>
                      {% else %}
                      <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Previous">
                          <span aria-hidden="true">&laquo;</span>
                        </a>
                      </li>
                      {% endif %}
              
                      <!-- Page Number Links -->
                      {% for num in product_objects.paginator.page_range %}
                        {% if product_objects.number == num %}
                          <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                        {% else %}
                          <li class="page-item"><a class="page-link" href="?page={{ num }}{% if request.GET.item_name %}&item_name={{ request.GET.item_name }}{% endif %}">{{ num }}</a></li>
                        {% endif %}
                      {% endfor %}

                      <!-- Next Page Link -->
                      {% if product_objects.has_next %}
                      <li class="page-item">
                        <a class="page-link" href="?page={{ product_objects.next_page_number }}{% if request.GET.item_name %}&item_name={{ request.GET.item_name }}{% endif %}" aria-label="Next">
                          <span aria-hidden="true">&raquo;</span>
                        </a>
                      </li>
                      {% else %}
                      <li class="page-item disabled">
                        <a class="page-link" href="#" aria-label="Next">
                          <span aria-hidden="true">&raquo;</span>
                        </a>
                      </li>
                      {% endif %}

                    </ul>
                  </nav>
                </div>
              </div>
            </ul>
          </nav>
        </div>  
      </div>
     <!-- End Pagination -->
  </body>

<<<<<<< HEAD
  <!-- JavaScript -->
  <script type="text/javascript">
    
    console.log('this is working');

    if(localStorage.getItem('cart') == null){
=======
  <script type="text/javascript">

    console.log("Welcome to Luxury Collection - Premium Ecommerce!");

    // CHECK IF CART IS EMPTY
    if (localStorage.getItem('cart') === null) {
>>>>>>> d7390dd164519c535f2523a38e744b23f49144c9
      var cart = {};
    }
    else{
      cart = JSON.parse(localStorage.getItem('cart'));
<<<<<<< HEAD
    }

    $(document).on('click', '.atc', function(){
      console.log('clicked');
      var item_id = this.id.toString();
      console.log(item_id);

      if(cart[item_id] == undefined){
        cart[item_id] = 1;
      }
      else{
        cart[item_id] = cart[item_id] + 1;
      }

      // 2. Save the updated cart back to localStorage
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartUI();
      
      // 3. Log it HERE to see the changes after the click
      console.log("Current Cart Content: " + JSON.stringify(cart));

      console.log("Number of items in cart: " + Object.keys(cart).length);

      document.getElementById('cart').innerHTML = `Cart (${Object.keys(cart).length})`;

      

    });

    // $(function () {
    //   $('[data-toggle="popover"]').popover();
    //   document.getElementById('cart')
    //   .setAttribute('data-content', `<h4>You have ${Object.keys(cart).length} item(s) in your cart.</h4>`);
    // });

    DisplayCart(cart);

    function DisplayCart(cart){
      var cartString = "";
      var cartIndex = 1;

      cartString += `<h4>You have ${Object.keys(cart).length} item(s) in your cart.</h4>`;

      for(var item in cart){
        cartString  += cartIndex;
        cartString  += document.getElementById('nm-' + item).innerHTML + 'Qty: ' + cart[item] + '<br>';
        cartIndex   += 1;
      }

      document.getElementById('cart').setAttribute('data-content', cartString);
      $('[data-toggle="popover"]').popover();
    }

    function updateCartUI() {
        // Update the Navbar Button Text
        var totalItems = Object.keys(cart).length;
        document.getElementById('cart').innerHTML = `Cart (${totalItems})`;

        // Build the Popover Content String
        var cartString = "<h5>Your Luxury Selection</h5><hr>";
        var cartIndex = 1;

        for (var item in cart) {
            var itemNameElement = document.getElementById('nm-' + item);
            if (itemNameElement) {
                var itemName = itemNameElement.innerHTML;
                cartString += `${cartIndex}. ${itemName} | Qty: ${cart[item]}<br>`;
                cartIndex++;
            }
        }
        
        if (totalItems === 0) {
            cartString = "<h5>Your cart is empty</h5>";
        } else {
            // Add a Checkout button at the bottom of the popover
            cartString += "<hr><a href='checkout/' class='btn btn-dark btn-sm btn-block'>Checkout</a>";
        }

        // Apply content and initialize/refresh popover
        var cartBtn = $('#cart');
        cartBtn.attr('data-content', cartString);
        cartBtn.popover(); 
    }

  </script>
  <!-- End JavaScript -->

  <!-- CSS -->
  <style>
    /* Notification styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease;
    }

    .notification.success {
      background-color: #28a745;
      color: white;
    }

    .notification.error {
      background-color: #dc3545;
      color: white;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
  <!-- End CSS -->

=======
      console.log(cart); // DEBUG
    }

    $(document).on('click', '.atc', function(){
      console.log("Add to Cart button clicked");
      var item_id = this.id.toString();
      console.log( item_id);
    })
    
  </script>
>>>>>>> d7390dd164519c535f2523a38e744b23f49144c9
</html>
